<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${title}"></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/airdatepicker/air_datepicker.css">
    <link rel="stylesheet" href="/cosmoStyle.css">
</head>
<body class="body">
<form th:action="@{/logout}" method="post">
    <ul class="flexname gorisontalcolumn-akk font-20 nicecolor margin-top-40">
        <li>
            <h1 class="margin-0" th:inline="text">[[${#httpServletRequest.remoteUser}]]</h1>
        </li>
        <li>
            <button class="a_buttonform-3 padding-15 font-size-20" type="submit">Выйти из аккаунта</button>
        </li>
    </ul>
</form>
<ul class="fonts gorisontalcolumnbanner nicecolor">
    <li class="prevblock">
        <ul class="fonts gorisontalcolumn">
            <li>Прибыль</li>
            <li th:text="${curentMouthSummPlus}"></li>
        </ul>
        <ul class="fonts gorisontalcolumn">
            <li>Расходы</li>
            <li th:text="${curentMouthSummMinus}"></li>
        </ul>
    </li>
    <li>
        <ul class="fonts">
            <li>Итого</li>
            <li class="bigfont" th:text="${curentMouthSumm}"></li>
        </ul>
    </li>
</ul>

<!--Поиск по клиентам-->
<div class="homeInvertBlock">
        <div class="widgetRow">
            <input hidden name="id" type="text" id="clientId" class="inputenumberlement homeInpun" readonly>
            <input type="text" id="clientData" list="clients" class="inputenumberlement homeInpun">
            <button style="display: block" type="button" class="buttonform fonts homeInvertButton" onclick="getClientInfo()">Найти</button>
            <datalist id="clients"></datalist>
        </div>
</div>

<!--Доходы и расходы-->
<div class="widgetRowTogether" style="justify-content: space-evenly">
    <a href='/income' class="buttonform fonts" style="background-color: #f9f9f9; color: #514f4e">Доходы</a>
    <a href='/expenses' class="buttonform fonts" style="background-color: #f9f9f9; color: #514f4e">Расходы</a>
</div>

<!--Мои записи-->
<ul class="calcelementul">
    <p class="centertext fonts">Мои записи</p>
    <li class="calcelementhome fonts" th:each="note : ${lastNotes}">

        <div style="display: flex; flex-direction: column; width: 100%;">
            <div class="widgetRow">
                <h3 class="fonts dateFonts" th:text="${note.day}"></h3>
                <!--                            <h3 class="fonts dateFonts" th:text="${note.timeProperty}"></h3>-->
                <h3 class="fonts countNoteFonts" th:text="${note.countDaysNotes}"></h3>
            </div>
            <ul>
                <li th:each="op : ${operationsMainPage}" th:if="${op.day == note.day}">
                    <div style="display: flex; flex-direction: row;">
                        <h4 class="dateTime" th:text="${op.time}"></h4>

                        <div style="display: flex; flex-direction: column; width: 100%;">
                            <div style="display: flex; flex-direction: row; justify-content: space-between;">
                                <p class="blockV2 niceFont" th:text="${op.name}"></p>
                                <img srcset="https://img.icons8.com/ios/420/more.png 2x"
                                     style="width: 52px; height: 52px; filter: invert(0%) sepia(0%) saturate(7500%) hue-rotate(327deg) brightness(96%) contrast(104%);"
                                     alt="подробнее">
                            </div>
                            <div style="display: flex; flex-direction: row; height: 50px;">
                                <h5 class="blockV2 smallfonts niceFont"
                                    style="color: gray; width: 50%; margin: 0 0 0 60px; text-transform: capitalize;"
                                    th:text="${op.clientName}"></h5>
                                <p class="blockV2 smallfonts niceFont"
                                   style="color: gray; width: 60%; margin: 0 0 0 30px; text-transform: capitalize;"
                                   th:text="${op.medicament}"></p>
                                <!-- <p class="blockV2 smallfonts" style="color: gray; width: 60%; margin: 0 0 0 30px;">50000 ₽</p> -->
                            </div>
                        </div>
                    </div>
                    <hr>
                </li>

            </ul>

        </div>
    </li>
    <a href="/newnote" class="buttonform fonts" style="margin: 25px 25px 25px 425px; width: 340px;">Все записи</a>
</ul>

<!--История-->
<ul class="calcelementul">
    <p class="centertext fonts">История</p>
    <li class="calcelementhome fonts" th:each="el : ${lastPosts}">
        <div class="widgetRow">
            <div>
                <h4 class="leftmiddle blockmain vertcenter" th:if="${el.summary_type == 'Доход'}">
                    <img src="https://img.icons8.com/cotton/64/000000/deposit--v1.png"/>
                </h4>
                <h4 class="leftmiddle blockmain vertcenter" th:if="${el.summary_type == 'Расход'}">
                    <img src="https://img.icons8.com/cotton/64/000000/withdrawal--v1.png"/>
                </h4>
            </div>
            <div>
                <p class="blockV2 niceFont" style="margin: 0; width: 400px" th:text="${el.procedures}"></p>
                <p class="blockV2 niceFont smallfonts" th:text="${el.day}"></p>
            </div>
            <div style="display: flex; flex-direction: row; justify-content: flex-end">
                <p class="blockV2 niceFont" th:text="${el.summary}"></p>
                <p class="blockV2 niceFont" style="margin: 10px">₽</p>
            </div>
        </div>

    </li>
    <div class="widgetRowTogether">
        <a href='/history' class="buttonform fonts" style="width: 320px; margin-left: 5%;">Вся история</a>
        <a href="/editposts" class="buttonform fonts">Изменить</a>
    </div>
</ul>

<!--Месяцы-->
<ul class="columnreverse">
    <li class="calcelementul" th:each="current : ${mouthCalendar}">
        <ul class=summanddate>
            <li class="smallmiddle blockmouth calcmargin middlefont" th:text="${current.mounthYear}">
            <li class="smallmiddle blockmouth calcmargin bigfont" th:text="${current.summary}">
        </ul>
    </li>
</ul>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script type="text/javascript" src="/airdatepicker/air-datepicker.js"></script>
<script>
    new AirDatepicker('#calendar', {
        // inline: true,
        classes: 'airdateclicker',
        isMobile: true,
        autoClose: true,
        dateFormat: 'yyyy-MM-dd'
    });
</script>
<script>
    var responseBody;
    var clientData;
    var clientId;

    $(document).ready(function () {
        $.ajax({
            type: 'GET',
            url: '/newnote/create/select-client/all_my_clients',
            dataType: 'json',
            success: function (all_my_clients) {
                responseBody = all_my_clients;
                all_my_clients.forEach((item) => {
                    var option = document.createElement('option');
                    option.innerHTML = item.client.data;
                    document.getElementById('clients').prepend(option)
                })
            }
        });
    });

    function getClientInfo() {
        clientData = document.getElementById('clientData').value;
        clientId = responseBody.filter(function (item) {
            return item.client.data === clientData
        })[0].client.id
        $.ajax({
            type: 'GET',
            url: '/client_info?id=' + clientId,
            dataType: 'json',
            data: clientId
        });
        window.location.href = "/client_info?id=" + clientId;
    }

</script>
</html>